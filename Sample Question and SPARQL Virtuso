Changed  - 1.1, 1.2, 1.3, 2.1, 2.2, 3.1, 3.2, 3.3, 3.4, 3.5



# 1.Object - Location/Footprint:
## 1.1 Where is the "Schlehdorf" gauging station located within the catchment area? [What are the coordinates] - ## Tested and working

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX schema: <https://schema.org/>

SELECT ?wkt ?easting ?northing ?elevation
FROM <http://hydroturtle/LamahCE>
WHERE {
    # Find the sensor with the name "Bangs"
    ?sensor schema:name "Bangs" ;
            geo:hasGeometry ?geom .
    
    # Get the WKT representation
    ?geom geo:asWKT ?wkt .
    
    # Convert WKT into geometry object using Virtuoso functions
    BIND (bif:st_geomfromtext(?wkt) AS ?geomObj)
    
    # Extract coordinates using Virtuoso spatial functions
    BIND (bif:st_x(?geomObj) AS ?easting)   # Longitude
    BIND (bif:st_y(?geomObj) AS ?northing)  # Latitude
    BIND (bif:st_z(?geomObj) AS ?elevation) # Elevation
}



1.2 Where are the gauging stations located within the catchment areas for high annual precipitation in 2015? (maximum 3) - 
precipitation[envthes:30106] (flow rate for this time - envthes:21242) - ## Tested and working. (only flow rate data is uploaded at the moment) 

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>

SELECT ?stationName ?easting ?northing (SUM(?flowRate) AS ?totalFlowRate)
FROM <http://hydroturtle/LamahCE>
WHERE {

     # Find the observations with precipitation[envthes:30106] (flow rate for this time - envthes:21242) 
     ?observation rdf:type sosa:Observation ;
               sosa:observedProperty envthes:21242 ;
               sosa:madeBySensor ?station ;
               sosa:resultTime ?resultTime ;
               sosa:hasResult ?result .

      #Filter results of 2015
      FILTER(YEAR(?resultTime) = 2015)

      # Access the blank node for QuantityValue
     ?result rdf:type qudt:QuantityValue ;
           qudt:numericValue ?flowRate;
           qudt:unit unit:M3-PER-SEC.

     # Retrieve gauging station and location details
     ?station rdf:type sosa:Sensor ;
           schema:name ?stationName ;
          geo:hasGeometry ?locationGeometry .

    ## Get the WKT representation
    ?locationGeometry geo:asWKT ?wkt .

    # Convert WKT into geometry object using Virtuoso functions
    BIND (bif:st_geomfromtext(?wkt) AS ?geomObj)
    
    # Extract coordinates using Virtuoso spatial functions
    BIND (bif:st_x(?geomObj) AS ?easting)   # Longitude
    BIND (bif:st_y(?geomObj) AS ?northing)  # Latitude

}

# Group by station to sum precipitation values (this one is for flow rate for now) for each station in 2015
GROUP BY ?stationName ?easting ?northing
ORDER BY DESC(?totalFlowRate)
LIMIT 3


1.3 Where are the largest 5 catchment areas in this dataset?

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>

SELECT ?stationName ?catchment ?catchmentArea ?easting ?northing
FROM <http://hydroturtle/LamahCE>
WHERE {

       #find the station name 
       ?sensor schema:name ?stationName;
                    n4e_hyd:monitorsCatchment ?catchment;
                    geo:hasGeometry ?locationGeometry .

       # Find the catchment area
       ?catchment n4e_hyd:catchment_area_calculated ?catchmentArea.

      # This is addition to the question
      ## Get the WKT representation
      ?locationGeometry geo:asWKT ?wkt . 

      ## Convert WKT into geometry object using Virtuoso functions
      BIND (bif:st_geomfromtext(?wkt) AS ?geomObj)
    
      ## Extract coordinates using Virtuoso spatial functions
      BIND (bif:st_x(?geomObj) AS ?easting)   # Longitude
      BIND (bif:st_y(?geomObj) AS ?northing)  # Latitude

}

# take the largest catchment area.  
ORDER BY DESC(?catchmentArea)
LIMIT 5

2.1 What are the boundaries of the catchment with the highest precipitation in 2012? - tested in Virtuoso [ this is run for fow rate because only updated flow rate to the triple store at the moment.] 
[need to update again after update WKT as direct geom object. then conversion of bif:st_geomfromtext(?catchmentWKT) is not required] 

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX virtrdf: <http://www.openlinksw.com/schemas/virtrdf#>

SELECT ?neighbourCatchment ?catchment ?maxFlow ?time ?neighbourCatchmentWKT 
FROM <http://hydroturtle/LamahCE>
WHERE {
    # Find the catchment with the highest flow rate between 2012-2016
    {

        SELECT ?catchment ?catchmentWKT (MAX(?flowRate) AS ?maxFlow) ?time
        WHERE {
            # Find the observations with precipitation[envthes:30106] (flow rate for this time - envthes:21242) - 
            # precipitation can be written as directly associalted with catchment as observerd property 
            ?observation rdf:type sosa:Observation ;
                sosa:observedProperty envthes:21242 ;
                sosa:madeBySensor ?sensor ;
                sosa:resultTime ?time ;
                sosa:hasResult ?result.

            ## take the flow rate value
            ?result qudt:numericValue ?flowRate;
                    qudt:unit  unit:M3-PER-SEC.

            # Take the catchment geometry as WKT
            ?sensor n4e_hyd:monitorsCatchment ?catchment .
            ?catchment geo:hasGeometry ?catchmentGeometry.
            ?catchmentGeometry geo:asWKT ?catchmentWKT.

           FILTER (?time >= "2012-01-01"^^xsd:dateTime && ?time <= "2015-12-31"^^xsd:dateTime)
              #FILTER (xsd:dateTime(?time) >= "2016-01-01T00:00:00Z"^^xsd:dateTime &&
            #xsd:dateTime(?time) <= "2016-12-31T23:59:59Z"^^xsd:dateTime)
}
        ORDER BY DESC(?maxFlow)
        LIMIT 1

}

            #from here this should try to take 
            ?neighbourCatchment rdf:type envthes:30212 ;
                                geo:hasGeometry ?neighbourCatchmentGeom .

            ?neighbourCatchmentGeom geo:asWKT ?neighbourCatchmentWKT .

            # Convert WKT into geometry object using Virtuoso functions
            BIND (bif:st_geomfromtext(?catchmentWKT) AS ?geomObjCat)
            BIND (bif:st_geomfromtext(?neighbourCatchmentWKT ) AS ?geomObjCatNeig)

            FILTER (?neighbourCatchment != ?catchment) # Exclude the max flow catchment
            FILTER bif:st_intersects(?geomObjCat, ?geomObjCatNeig, 0) # 0 distance means touching borders

        }

2.2 What is the boundary of the "Oberammergau" gauging station area for discharge monitoring? [in here the station name "Garsella" used since only 35 stations uploaded to triples store at the moment.]

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX virtrdf: <http://www.openlinksw.com/schemas/virtrdf#>

SELECT ?neighbourCatchment ?neighbourSensorName ?catchmentGiven 
FROM <http://hydroturtle/LamahCE>
WHERE {
    # Find the catchment with the highest flow rate between 2012-2016
    {

        SELECT ?catchmentGiven ?catchmenGiventWKT 
        WHERE {
            # Find the sensor with the name "Garsella" and catchment associated with it
            ?sensorGiven rdf:type sosa:Sensor;
                    schema:name "Garsella";
                    n4e_hyd:monitorsCatchment ?catchmentGiven.

            # take the catchment geomatery of the particular sensor 
            ?catchmentGiven geo:hasGeometry ?catchmentGivenGeometry.
            ?catchmentGivenGeometry geo:asWKT ?catchmenGiventWKT.

}

}

            #Take the neighbouring catchements. 
            ?neighbourCatchment rdf:type envthes:30212 ;
                                geo:hasGeometry ?neighbourCatchmentGeom .

            ?neighbourSensor rdf:type sosa:Sensor;
                             schema:name ?neighbourSensorName;
                             n4e_hyd:monitorsCatchment ?neighbourCatchment.

            ?neighbourCatchmentGeom geo:asWKT ?neighbourCatchmentWKT .

            # Convert WKT into geometry object using Virtuoso functions
            BIND (bif:st_geomfromtext(?catchmenGiventWKT) AS ?geomObjCatGiven)
            BIND (bif:st_geomfromtext(?neighbourCatchmentWKT ) AS ?geomObjCatNeig)

            FILTER (?neighbourCatchment != ?catchmentGiven) # exclude the given catchment from the selection 
            FILTER bif:st_intersects(?geomObjCatGiven, ?geomObjCatNeig, 0) # 0 distance means touching borders

        }




3.1 What is the surface area of the largest catchment in the dataset?

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX virtrdf: <http://www.openlinksw.com/schemas/virtrdf#>

SELECT ?guagingStationName ?catchment ?catchmentArea
FROM <http://hydroturtle/LamahCE>
WHERE {
    # take the catchement areas of catchements (envthes:30212 is the catchement class)
    ?catchment rdf:type envthes:30212 ;
	           n4e_hyd:catchment_area_calculated ?catchmentArea. 

    # find the name of the sensor related with catchement
    ?sensor n4e_hyd:monitorsCatchment ?catchment;
            schema:name ?guagingStationName. 
}
ORDER BY DESC(?catchmentArea)
LIMIT 1


3.2 What is the average annual precipitation in catchment 1 for the period between 2010 and 2020?

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX virtrdf: <http://www.openlinksw.com/schemas/virtrdf#>

SELECT ?guagingStationName (AVG(?yearlyTolalFlowrate) AS ?averageAnnualFlowRate)
FROM <http://hydroturtle/LamahCE>
WHERE {

    {
        SELECT ?resultYear (SUM(?flowRate) AS ?yearlyTolalFlowrate) ?guagingStationName
        WHERE {
            
            # Find the observations with precipitation[envthes:30106] (flow rate for this time - envthes:21242) - 
            # precipitation can be written as directly associalted with catchment as observerd property 
            ?observation rdf:type sosa:Observation ;
                sosa:observedProperty envthes:21242 ;
                sosa:madeBySensor ?sensor ;
                sosa:resultTime ?resultTime ;
                sosa:hasResult ?result.

            ## # Access the blank node to retrieve the precipitation value [for this case used flow rate due to uploaded data for the moment to triple store ]
            ?result qudt:numericValue ?flowRate;
                    qudt:unit  unit:M3-PER-SEC.

            # find catchment related with sensor 
            ?sensor n4e_hyd:monitorsCatchment n4e_hyd:catchment_1;
                    schema:name ?guagingStationName

            # Extract the year directly in the FILTER and assign to ?year [this query is written between 2012 to 2015 for the moment data is uploaded]
            BIND (YEAR(?resultTime) AS ?resultYear)
            FILTER (?resultYear >= 2012 && ?resultYear <= 2015)
        }
        GROUP BY ?resultYear ?guagingStationName
    }
}
  

## same question with what is the annual average flow rate of all the guaging station between 2012-2015

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX virtrdf: <http://www.openlinksw.com/schemas/virtrdf#>

SELECT ?guagingStationName (AVG(?yearlyTolalFlowrate) AS ?averageAnnualFlowRate)
FROM <http://hydroturtle/LamahCE>
WHERE {

    {
        SELECT ?resultYear (SUM(?flowRate) AS ?yearlyTolalFlowrate) ?guagingStationName
        WHERE {
            
            # Find the observations with precipitation[envthes:30106] (flow rate for this time - envthes:21242) - 
            # precipitation can be written as directly associalted with catchment as observerd property 
            ?observation rdf:type sosa:Observation ;
                sosa:observedProperty envthes:21242 ;
                sosa:madeBySensor ?sensor ;
                sosa:resultTime ?resultTime ;
                sosa:hasResult ?result.

            ## # Access the blank node to retrieve the precipitation value [for this case used flow rate due to uploaded data for the moment to triple store ]
            ?result qudt:numericValue ?flowRate;
                    qudt:unit  unit:M3-PER-SEC.

            # find catchment related with sensor 
            ?sensor n4e_hyd:monitorsCatchment ?catchment;
                    schema:name ?guagingStationName

            # Extract the year directly in the FILTER and assign to ?year [this query is written between 2012 to 2015 for the moment data is uploaded]
            BIND (YEAR(?resultTime) AS ?resultYear)
            FILTER (?resultYear >= 2012 && ?resultYear <= 2015)
        }
        GROUP BY ?resultYear ?guagingStationName
    }
}



## same quesion with each year average precipitation [query is for flow rate] 

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX virtrdf: <http://www.openlinksw.com/schemas/virtrdf#>

SELECT ?resultYear (AVG(?flowRate) AS ?yearlyAvgFlowrate) ?guagingStationName
FROM <http://hydroturtle/LamahCE>
WHERE {
            # Find the observations with precipitation[envthes:30106] (flow rate for this time - envthes:21242) - 
            # precipitation can be written as directly associalted with catchment as observerd property 
            ?observation rdf:type sosa:Observation ;
                sosa:observedProperty envthes:21242 ;
                sosa:madeBySensor ?sensor ;
                sosa:resultTime ?resultTime ;
                sosa:hasResult ?result.

            ## # Access the blank node to retrieve the precipitation value [for this case used flow rate due to uploaded data for the moment to triple store ]
            ?result qudt:numericValue ?flowRate;
                    qudt:unit  unit:M3-PER-SEC.

            # find catchment related with sensor 
            ?sensor n4e_hyd:monitorsCatchment ?catchment;
                    schema:name ?guagingStationName

            # Extract the year directly in the FILTER and assign to ?year [this query is written between 2012 to 2015 for the moment data is uploaded]
            BIND (YEAR(?resultTime) AS ?resultYear)
            FILTER (?resultYear >= 2012 && ?resultYear <= 2015)
        }
        GROUP BY ?resultYear ?guagingStationName

Q3.3)What is the elevation of the "Schlehdorf" gauging station? [query is written for "Beschling" since only 35 station are uploaded to triple store at the moment ] 
# when WKT is written with "^^geo:wktLiteral, conversion to geom object is not required. 

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX virtrdf: <http://www.openlinksw.com/schemas/virtrdf#>

SELECT ?easting ?northing ?elevation ?geomObj
FROM <http://hydroturtle/LamahCE>
WHERE {

    # Find the sensor with the name "Beschling"
    ?sensor schema:name "Beschling" ; # change to "Schlehdorf" as mentioned in the question. 
            geo:hasGeometry ?geom .
    
    # Get the WKT representation
    ?geom geo:asWKT ?wkt .
    
    # Convert WKT into geometry object using Virtuoso functions
    BIND (bif:st_geomfromtext(?wkt) AS ?geomObj)
    
    # Extract coordinates using Virtuoso spatial functions
    BIND (bif:st_x(?geomObj) AS ?easting)   # Longitude
    BIND (bif:st_y(?geomObj) AS ?northing)  # Latitude
    BIND (bif:st_z(?geomObj) AS ?elevation) # Elevation
}

Q3.4) What is the highest average monthly evaporation recorded at catchment 2 over the last decade?
[this query is written to take the flow at guaging station "Gisingen" because only flow is updated. Catchment observations can be taken much directly by sosa:hasFeatureOfInterest ]

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX virtrdf: <http://www.openlinksw.com/schemas/virtrdf#>

SELECT ?resultMonth (SUM(?flowRate) AS ?monthlyTolalFlowrate) #?guagingStationName
FROM <http://hydroturtle/LamahCE>
WHERE {
        # Find the observations with precipitation[envthes:30106] (flow rate for this time - envthes:21242) - 
        # precipitation can be written as directly associalted with catchment as observerd property 
        ?observation rdf:type sosa:Observation ;
            sosa:observedProperty envthes:21242 ;
            sosa:madeBySensor ?sensor ;
            sosa:resultTime ?resultTime ;
            sosa:hasResult ?result.

        ## # Access the blank node to retrieve the precipitation value [for this case used flow rate due to uploaded data for the moment to triple store ]
        ?result qudt:numericValue ?flowRate;
                qudt:unit  unit:M3-PER-SEC.

        # find catchment related with sensor 
        ?sensor n4e_hyd:monitorsCatchment ?catchment;
                schema:name "Gisingen" #?guagingStationName

        # Extract the year and month assigned to ?resultYear and ?resultMonth directly 
        BIND (YEAR(?resultTime) AS ?resultYear)
        BIND (MONTH(?resultTime)AS ?resultMonth)

        # Filter and assign to ?year [this query is written between 2012 to 2014 for the moment data is uploaded]
        FILTER (?resultYear >= 2012 && ?resultYear <= 2013)
    }
    GROUP BY ?resultMonth #?guagingStationName
    ORDER BY DESC(?monthlyTolalFlowrate)
    #LIMIT 1   # can use limit to see only the maximum




Q3.5) What is the all-time minimum and maximum river flow observed at the "Schwarzach" gauging station?

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX virtrdf: <http://www.openlinksw.com/schemas/virtrdf#>

SELECT ?guagingStationName (MIN(?flowRate) AS ?minRiverFlow) (MAX(?flowRate) AS ?maxRiverFlow)
FROM <http://hydroturtle/LamahCE>
WHERE {
    # Find the observations with precipitation[envthes:30106] (flow rate for this time - envthes:21242) - 
    # precipitation can be written as directly associalted with catchment as observerd property 
    ?observation rdf:type sosa:Observation ;
        sosa:observedProperty envthes:21242 ;
        sosa:madeBySensor ?sensor ;
        sosa:resultTime ?resultTime ;
        sosa:hasResult ?result.

    ## # Access the blank node to retrieve the precipitation value [for this case used flow rate due to uploaded data for the moment to triple store ]
    ?result qudt:numericValue ?flowRate;
            qudt:unit  unit:M3-PER-SEC.

    # find gauging station name 
    ?sensor schema:name "Schwarzach" .   
    }

Q3.5)_2 (extended version of same above question) What are the all-time minimum and maximum river flow observed at all the gauging stations?

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX virtrdf: <http://www.openlinksw.com/schemas/virtrdf#>

SELECT ?guagingStationName (MIN(?flowRate) AS ?minRiverFlow) (MAX(?flowRate) AS ?maxRiverFlow)
FROM <http://hydroturtle/LamahCE>
WHERE {
    # Find the observations with precipitation[envthes:30106] (flow rate for this time - envthes:21242) - 
    # Precipitation can be written as directly associated with catchment as observed property 
    ?observation rdf:type sosa:Observation ;
        sosa:observedProperty envthes:21242 ;
        sosa:madeBySensor ?sensor ;
        sosa:resultTime ?resultTime ;
        sosa:hasResult ?result.

    ## # Access the blank node to retrieve the precipitation value [for this case, used flow rate due to uploaded data for the moment to triple store ]
    ?result qudt:numericValue ?flowRate;
            qudt:unit  unit:M3-PER-SEC.

    # # find gauging station name  
    ?sensor n4e_hyd:monitorsCatchment ?catchment;
            schema:name ?guagingStationName #"Schwarzach"    ## use directly station name instead of ?guagingStationName variable only particular station data need to be extracted. 
    }
    GROUP BY ?guagingStationName #can remove GROUP BY - specially, only one gauging station is used. 

Q3.5) How many annual average frost days (days with temperatures below 0°C) were recorded at the "Dillingen" gauging station from 2010 to 2020? - ## need to double check the query . answers are bit confusing. 

PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX schema: <https://schema.org/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT ?year (AVG(?frostDays) AS ?averageAnnualFrostDays)
WHERE {
  {
    SELECT ?year (COUNT(?date) AS ?frostDays)
    WHERE {
      # Because the freezing is related to min air temp -  temperature observations at the "Dillingen" station for AirTemperature2mMin
      ?observation rdf:type sosa:Observation ;
                   sosa:observedProperty n4e_hyd:AirTemperature2mMin ;
                   sosa:madeBySensor ?sensor ;
                   sosa:resultTime ?date ;
                   sosa:hasResult ?result .
      
      # Filter for the "Dillingen" station and dates between 2010 and 2020
      ?sensor schema:name "Dillingen" .
      FILTER (YEAR(?date) >= 2010 && YEAR(?date) <= 2020)

      # Get temperature value and check if it's below 0°C
      ?result qudt:numericValue ?temperature .
      FILTER (?temperature < 0)

      # Extract the year for grouping
      BIND(YEAR(?date) AS ?year)
    }
    GROUP BY ?year
  }
}
GROUP BY ?year
ORDER BY ?year


Q4.1) What is the spatial relationship (distance, elevation difference)  between the "Bangs" and "Loruens-Aeule" gauging stations? - # this cannot be tested 
# error in graphDB - 500: Error, Query evaluation error: Unknown function 'http://jena.apache.org/function/spatial#greatCircleGeom'

PREFIX n4e_hyd: <https://nfdi4earth.pages.rwth-aachen.de/knowledgehub/nfdi4earth-ontology/test_hyd#>
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX envthes: <http://vocabs.lter-europe.net/EnvThes/>
PREFIX qudt: <https://qudt.org/schema/qudt/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX unit: <https://qudt.org/vocab/unit/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX spatialF: <http://jena.apache.org/function/spatial#>
PREFIX units: <http://www.opengis.net/def/uom/OGC/1.0/>

SELECT ?altitude_diff ?distance ?longitude_1 ?latitude_1 ?longitude_2 ?latitude_2
WHERE {
  # Define the first sensor ("Bangs") and retrieve its location details
  ?sensor_1 rdf:type sosa:Sensor ;
            schema:name "Bangs" ;
            locn:location ?location_1 .
  
  ?location_1 locn:geometry ?geometry_1 .
  ?geometry_1 geo:alt ?altitude_1 ;
              locn:longitude ?longitude_1 ;
              locn:latitude ?latitude_1 .

  # Define the second sensor ("Loruens-Aeule") and retrieve its location details
  ?sensor_2 rdf:type sosa:Sensor ;
            schema:name "Loruens-Aeule" ;
            locn:location ?location_2 .
  
  ?location_2 locn:geometry ?geometry_2 .
  ?geometry_2 geo:alt ?altitude_2 ;
              locn:longitude ?longitude_2 ;
              locn:latitude ?latitude_2 .

  # Calculate the altitude difference
  BIND(ABS(?altitude_1 - ?altitude_2) AS ?altitude_diff)

  # Construct the points as plain strings
  BIND(CONCAT("Point(", STR(?longitude_1), " ", STR(?latitude_1), ")") AS ?point1)
  BIND(CONCAT("Point(", STR(?longitude_2), " ", STR(?latitude_2), ")") AS ?point2)

  # Calculate the great-circle distance if supported
  BIND(spatialF:greatCircleGeom(?point1, ?point2, units:kilometre) AS ?distance)
}


## other option is to take square distance because sqareroot is not available with SPARQL 
PREFIX sosa: <http://www.w3.org/ns/sosa/>
PREFIX schema: <https://schema.org/>
PREFIX locn: <http://www.w3.org/ns/locn#>
PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT ?altitude_diff ?squared_distance ?long_dif
WHERE {
  # Define the first sensor ("Oberammergau") and retrieve its location details
  ?sensor_1 rdf:type sosa:Sensor ;
            schema:name "Oberammergau" ;
            locn:location ?location_1 .

  ?location_1 locn:geometry ?geometry_1 .
  
  ?geometry_1 geo:alt ?altitude_1 ;
              locn:longitude ?longitude_1 ;
              locn:latitude ?latitude_1 .

  # Define the second sensor ("Schlehdorf") and retrieve its location details
  ?sensor_2 rdf:type sosa:Sensor ;
            schema:name "Schlehdorf" ;
            locn:location ?location_2 .

  ?location_2 locn:geometry ?geometry_2 .
  
  ?geometry_2 geo:alt ?altitude_2 ;
              locn:longitude ?longitude_2 ;
              locn:latitude ?latitude_2 .

  # Convert longitude and latitude to decimal for calculations
  BIND(xsd:decimal(?longitude_1) AS ?long1_decimal)
  BIND(xsd:decimal(?latitude_1) AS ?lat1_decimal)
  BIND(xsd:decimal(?longitude_2) AS ?long2_decimal)
  BIND(xsd:decimal(?latitude_2) AS ?lat2_decimal)

  # Calculate the altitude difference
  BIND(ABS(xsd:decimal(?altitude_1) - xsd:decimal(?altitude_2)) AS ?altitude_diff)

  # Calculate the approximate squared distance
  BIND(((?long2_decimal - ?long1_decimal) * (?long2_decimal - ?long1_decimal) +
        (?lat2_decimal - ?lat1_decimal) * (?lat2_decimal - ?lat1_decimal)) AS ?squared_distance)
  
  # Calculate longitude difference
  BIND((?long2_decimal - ?long1_decimal) AS ?long_dif)
}




